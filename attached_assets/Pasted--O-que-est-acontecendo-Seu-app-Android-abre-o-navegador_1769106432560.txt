 O que est√° acontecendo?
Seu app Android abre o navegador do sistema (Chrome, etc.) para fazer login.

Ap√≥s o login, redireciona para https://bibliafs.com.br/auth/callback.

Mas seu app nativo (APK) n√£o recebe nem salva essa sess√£o.
Ao reabrir o app, ele n√£o sabe que o usu√°rio j√° est√° logado, ent√£o pede login novamente.

üîë O problema: voc√™ est√° usando autentica√ß√£o web, mas n√£o est√° integrando a sess√£o de volta ao app Android.

‚úÖ Solu√ß√£o: Use Custom Tabs + Deep Linking ou Supabase Auth no pr√≥prio app

Op√ß√£o 1: Mantenha o fluxo web, mas use Deep Links (recomendado para APK simples)

Passo 1: Configure um Deep Link no AndroidManifest.xml
Adicione isso dentro da <activity> principal do seu app:

xml:
<intent-filter android:autoVerify="true">
    <action android:name="android.intent.action.VIEW" />
    <category android:name="android.intent.category.DEFAULT" />
    <category android:name="android.intent.category.BROWSABLE" />
    <data android:scheme="https" android:host="bibliafs.com.br" android:pathPrefix="/auth/callback" />
</intent-filter>


Isso faz com que, ap√≥s o login, o Android abra seu app em vez do navegador.

Passo 2: No seu app, capture a URL de retorno
No c√≥digo (ex: MainActivity.java ou MainActivity.kt):

kotlin:

override fun onNewIntent(intent: Intent?) {
    super.onNewIntent(intent)
    val uri = intent?.data
    if (uri != null && uri.toString().contains("access_token")) {
        // Extraia o token e salve localmente
        val accessToken = uri.getQueryParameter("access_token")
        val refreshToken = uri.getQueryParameter("refresh_token")
        
        // Salve no SharedPreferences
        val prefs = getSharedPreferences("auth", Context.MODE_PRIVATE)
        prefs.edit()
            .putString("access_token", accessToken)
            .putString("refresh_token", refreshToken)
            .apply()
    }
}

Passo 3: Ao iniciar o app, verifique se h√° tokens salvos
kotlin:

val prefs = getSharedPreferences("auth", Context.MODE_PRIVATE)
val accessToken = prefs.getString("access_token", null)

if (accessToken != null) {
    // V√° direto para o dashboard
    startActivity(Intent(this, DashboardActivity::class.java))
} else {
    // Mostre a tela de login
}

Op√ß√£o 2: Use o SDK do Supabase diretamente no app Android (melhor abordagem)
Se seu app √© feito com React Native, Flutter, ou mesmo Kotlin/Java, voc√™ pode usar o Supabase Auth diretamente no app, sem abrir o navegador.

Exemplo com Kotlin (Android Nativo):
Adicione a depend√™ncia no build.gradle:

gradle:
implementation 'io.github.jan-tennert.supabase:gotrue-kt:2.0.0'

Fa√ßa login diretamente:

kotlin:
val supabase = SupabaseClient("https://olvumxgyoazdftdyasmx.supabase.co", "SEU_ANON_KEY")
val auth = supabase.auth

// Login com Google (via Custom Tab embutido)
auth.signInWithOAuth(
    provider = Provider.GOOGLE,
    redirectUrl = "bibliafs://login-callback"
)

Configure o redirectUrl personalizado (bibliafs://...) e capture no app.
Isso mant√©m tudo dentro do app e salva a sess√£o automaticamente.

Op√ß√£o 3: Se for um PWA (Progressive Web App) empacotado como APK
Se voc√™ gerou o APK usando PWA Builder ou Capacitor, ent√£o:

Certifique-se de que o localStorage est√° funcionando.
O Supabase salva a sess√£o automaticamente no localStorage ‚Äî mas alguns wrappers bloqueiam isso.
‚úÖ Solu√ß√£o: No Capacitor, adicione no capacitor.config.ts:

ts:
{
  server: {
    androidScheme: 'https'
  }
}

Isso permite que o localStorage funcione corretamente no Android.

üí° Dica final: Por que funciona na web, mas n√£o no APK?
Na web, o navegador salva cookies e localStorage ‚Üí sess√£o persistente.
No APK (se for um WebView ou PWA), o armazenamento pode ser limpo ao fechar, ou o contexto √© diferente.
üõ† A solu√ß√£o definitiva √© garantir que o token seja salvo no armazenamento persistente do Android (SharedPreferences, Secure Storage, etc.).


Resumo das a√ß√µes
Situa√ß√£o
Solu√ß√£o
App abre navegador externo
Use Deep Links para voltar ao app e salvar tokens
App √© PWA/WebView
Habilite androidScheme: 'https' no Capacitor ou verifique o localStorage
App nativo (Kotlin/Flutter)
Use o SDK do Supabase diretamente no app

